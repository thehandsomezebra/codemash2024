
... Back to [[index]] ...

[[Managing a Rewrite Without Getting Stuck in the Tar Pit]]

I started the recording a little late, but that's ok




```
Speaker 1   00:00
Dealing with old slow poorly configured systems. I love working in startups. I worked in so many startups and really, uh, so early stage startup is just using debt as a leverage take on all this Tech Tech, just so we can get a product out the door that people want and then we'll fix it. Later. Why? Okay? So the manager is in the audience, how often do Engineers come to you complaining about Tech Deck, A lot constantly. Do they have a plan? Not really sometimes. And so this is the problem if you see it I'm going to show you smart enough. You can see a following that in the code base and go ha. I just want to engineer to identified this problem. I will tell my manager. Yeah. Yeah. And then every other person on your team has probably done that and you say there's Tech Deck and I need to fix Tech done. So, the solution of this is not to not rewrite things, because that's real, but instead Think about it in the business perspective. Do your research. Why do people give your company money? What are they what do they get out of that? And how does this rewrite help us accomplish that? So what example is if like, You sell socks. You're the number one world retailer for premium custom socks. And you sit there and go, man, our daily player sucks. It's hard to work with. It's slow. There's a lot of tech done. That's one way of phrasing it. Another way presenting. The problem is to say, well, we took a look at the numbers. And the longer, the pain flow, the less likely it is that a user completes checkout and buy socks from us which is the whole point of our company. And we identified it in some tracings of ability stuff and said that the slow point for most of our slow requests is the database layer. We estimate rewrite it the database layer We'll bring in some X dollars of Revenue. It is. Okay, I know we're Engineers. We love like anything's down to the absolute furthest decimal point we can to give this a ballpark figure because not what you're saying is not, we will save 3 million dollars a year. We'll get 2.5 extra million dollars in Revenue. What you're saying I thought about this. And I understand the business context. I'm working in. Uh, a jellyfish in particular. We had a really messed up front end. And sat down and said, okay, what's, what's actually the problem here? There is Tech debt and no one wants to work with Django templates. That's for sure. What are the numbers? And we've looked and said, okay, well, we have tickets that are work on the back end code. So work on front end code. And on average, our front end code ticket, takes longer to do from. I'm starting work to get is done. And not only that the percentage of those tickets. That are bugs was much higher than the back end, so we had more bugs. It's a warmer to work. And customers weren't happy that way. There's like, who could gather together a bunch of customer complaints. And if that's the same way you're saying, it's Tech Deck. The nice thing is, we are a company that helps understand what percentage of your time we're spending on bugs. But I gave us some numbers to start with. And, Looking at those bugs and digging in. I realized All of these bogus are bugs at the edges where someone changed this function and someone change that function and then tried to call it and everything blew up. So, uh, the answer was actually another rewrite. I'll rewrite the existing react code into typescript. Just to catch those bikes and which showing up was like, hey, no. There's this big reread that's told in Target. We need to start a different rewrite. Is it tough call but it's a lot easier. Once you have the numbers to back it up, And just digging through jira, digging through your honoring desertability and talking like talking, the rest of the business can be a superpower, especially again. When you want to get promoted. Which leads us to the second target. So you can sit there and get a great presentation about how this is going to bring value to the company and it's very important on your manners, like great. This actually sounds really good. I like this. And then you go to all the other engineers and they're like, yeah, but I have other work or they go. Oh, I'll re-up with this rewrite. They take one ticket and run into a problem. Way screaming and it's you just never get off the ground. And I think a lot of the problem has to do with this word. Has anyone here written the documentation? Yeah, has anyone here a read documentation? On average. What's the quality of the red documentation you read? It's bad. It's not good. Is it just just, this is not helpful, really? I mean, that we're reaching for it like I read documentation. It does not help me solve my problems. And when it comes to documentation, you can get a master's degree of PhD is an entire deep field of study and writing, effective documentation. I don't know about you. I never got that. In my training event, you can go to a conference software, documentation and things like that. Uh, and so we sit down and write documentation and no one reads it. And so instead, uh, to avoid this target, there's a framework called diataxis and I'm like, 80 sure. I'm saying that correctly. If you get access says, hey, when will the right documentation? There's actually four kind of General categories that were by documentation in. Tutorials, help us learn How to guide help us accomplish our goals. An explanation deepens. Our understanding of a topic. And a reference is for when we've already had that deep understanding. And we just need to look something up quickly, to gain information. Most documentation that I have read was documentation reference, And I have been on so many rewrites for The Architects of the rewrite. Wrote this giant reference document. Breaking by an expert for other experts, and I was not an expert. And I I'll get to that later. And so instead like this is this is not anyone's fault. It's just like we never train anyone on these things. And so, instead coming into the typescript router, right? He said, okay how many people here work with typescript before like two or three people were like I know what typescript is great. Got my work cut out for me and instead of writing a long and detailed like here is typescript and all the how to do Fungible Union type infant. I don't know, I don't I'm not actually very good at types. Uh but I like textures and so I'm starting writing this tutorials. Hey what is a type? This is a python in JavaScript shop and a lot of folks have been there for a while. So I was like, okay, what is the type? Let's start there. Why are they important? How do they help us in those intersections where one function calls another And then how two guides specifically around. Our code base. And this how to guide wasn't a document, it was a pull request called the golden PR. And I went through found a fairly big component. You know, beat up the biggest component in the yard, uh, and converted the whole thing and then wrote down everything in the board request. And had somebody never written typescript. Before originally, they asked all of the questions you have, do not hold back, go through all that. So like I think we had like At least one comment per line, if not more, just because of all the back and forth and conversations, And this was all up. So hey if you want to convert something first you can get the idea. There's some toy examples to kind of get you started. Once you're there you have something to look at and say, all right, how do I actually do all of the details? And then finally built some of a deeper explanations around. Hey, here's the patterns we're using, uh, when is it okay to use any? It's a big one. I know there's a lot of people who are very strict about types and you never use any. And if I didn't really, like writing blog articles and found a lot of beginners are finding those blog articles and going. Oh, I must deeply type everything I find or else. I'm a bad programmer going? No, no, no. It's okay. We just need to get these things moving and having that goal of like, let's just get things moving rather than It's awful and honestly, never wrote any reference documentation. The typescript docs are already there. That's good. So that's the second target of documentation. How do you get, how do you build a way for people to fall in love into your expertise? Have those handholds to build start with the tutorial for the very Basics, all the way to a deep understanding of what you're trying to accomplish. Some of this, you'll be able to reference, you know, outside documentation. Sometimes you really need to write white aid is a superpower. And again, through all this To be honest here, the Imperial 10x engineer because you're leveling up everyone around. You, they're learning more. They're getting more, they're getting deeper in their understanding. And your boss is watching. The third Target.

Speaker 2   08:54
How do you convey? I go see people that love, you know, asking for every third out, or is it? We need to just keep you at going like this. Uh, so that's the struggle license, we have, is we meet you, the going five. I mean, no.

Speaker 1   09:21
Yeah, it's a really good question. How do you in this stage convince developers to not be perfectionists? Because, all right. Yeah. We, we like being perfect perfect. We want to be, you know, really good at code and all that. So, uh, and so here, I think it was in the discussion on the how-to guide like it was, I did not try to write the perfect conversion. I am so like, oh, why did you use anything? Well, this is calling the thing over there and that's big being scary and hasn't been converted. We also have a convention, we called an equine function. Which was a way to say, um, Any means? I know it's an object and it's big and scary. Blank means I have no idea what this is and you entice, what just lets you leave the type blank and infers any but allowed us to say, I don't know. Um, in a way that we can come back and fix later and then function, was because prop types is like, prop types. This is a function typescript's, like, okay, but what are its parameters? What does it return all that? And we just had a special type. It was just like This is a function. And being really clear in the documentation and the pr of Like leave by example. Definitely something I tried to do there uh of It's okay. And and so specifically, like if you just convert like the the File from JavaScript typescript. We're still getting down. It's still useful because we'll still get types from all the other files mostly types from all the third-party, libraries things like that. And, With all that said uh time boxing was a big deal for this project of not so much the time boxing the whole project but trying to break each conversion down logic into that a little bit. Uh, our goal is an afternoon. Like the tickets should be maximum afternoon if you're getting to an hour. Like an afternoon of work on a ticket and you're still undone that did like pull the hand down cord. Be like I need help or just like say hey putting this back. Somebody else can get this. I'm still new. So good question about about perfectionism of the goal. And again going back to the the first Target of like our goal is not to have perfect types. Our goal is to reduce bugs. Happy customers. If you're page breaking where a business intelligence tool. So uh, one of the funny things we talk about is we would rather fight you down than provide misleading information. Uh, and so we talked about that as the goal is not perfect types. The goal is Your butts and developers can empathize with that. Ah, yeah. So the third time a Target is the big bang. Um, I have done. This is a lot earlier in my career. I worked at a bunch of tiny startups that had you know, questionable code bases. And I went I couldn't do it better and try to rewrite everything from scratch. I think I'm sure. No one in this room has ever done. You've never made that mistake, but Because what happens? You're going to rewrite everything and you say, okay well, maybe not everything, but we read. Definitely the important parts or the parts that are the problem and you're starting from scratch. So you can do it right, this time. And you realize, Oh, there's all of these additional problems. I didn't think about, no matter how. Well, you do your research, the beginning, there will be problems that had been solved in the current code base that you now need to solve to With your rewriting with your new and to get new understandings using a new tool. And then you guys are doing that and you may have a team, they're enthusiastic you wrote a bunch of great documentation through business value and you're trying this big rewrite going and going and then The rest of the engineering work is still working on that main system and changing it. And you now need to make all of those changes in your system and it become the zenos Paradox. Where every time you catch up a little bit, they've also moved forward, even though you might seem like you're getting close. It just keeps going until someone from your director or VP comes up and says product. We need to release this now and you can feel that when a product team has to release a rewrite before it was done. Uh, slack being I think a phenomenal example of that their, their recent Redo of how slapworks missing both some of my favorite features. I am X slack. So a lot of us in the X flat slack are very bitter about that. Uh but yeah. So then no one wants that. That's a bad outcome at this point, you have to cut over and then your customers complaining. Hey, my favorite feature isn't here. So, how do we avoid that? And the thing to do here is the Strangler pattern. Which is one of those wonderful terms that, like it's amazing how violent some of our terms are here. Like oh hey, that's that's you know, something's wrong over there, just terminate all the children. Well, we decided to strangle everything. And it's named, uh, not after some new famous serial killers, I initially thought. But after, uh, the Strangler fate The Strangler fig is a wonderful hack on nature because in a rainforest, a dense rainforest. You either get light at the top or dirt at the bottom. And if you're a tree and you want to start growing, you need both. I need to pick one Zone to start in. And the spragraphy as we'll hack is as a fig. So animals eat it. It's delicious. The seeds are very sticky. So when they come out the other end, they tend to stick wherever the animal was at the moment. A lot of times that's at the top so good. We've got light checker. What about the dirt winning new trains to grow. Little bit in the scene itself and that's nice. It's brought a couple leaves and then it starts growing Roots into the tree. It's landed on. It's the vampiric thing and start sucking nutrients out of that tree and same thing. Roots down and around the tree down the bottom. And this is kind of like the Midway through the strangular, fake infestation, which I'm pretty sure is a Goosebumps book. And it was really cool. Coming here, having prep this talking, okay, I'm proud to talk about this triangular fig and then I walk down the stairs and see this. It's hard to tell them that picture, but if you look at that tree, you can actually see all of the Strangler fig Vines going up and down it. But after a while The Strangler paper was dense around the the host tree stocks up a bunch of nutrients in the tree but also puts its roots, into the ground itself. So now it's got light and dirt and starts sucking up those nutrients as well. And this is great for the strangular fig, but the host cream eventually dies. And you get this kind of cool looking thing where the there's just it's just missing the middle bit and this tree is alive and happy and the tree that surrounded is not just bad for the tree. Metaphor. It's really good for a rewrite because the rewrites aligned and happy and the original is not. And so the big battery, right? We say I'm going to start the scratch and rewrite everything. I don't I've never seen one of those succeed. I've tried so many times ran my head. Well, if you have had, does anyone have one of those 16? The big band rewrite. Did you write everything? A little bit. Okay, now one one or two hands. Uh don't recommend it so even if I was succeeded. Yeah. Well what what would you recommend? And just took forever. That's always a fun to play when you actually cut over, no matter how many tests you run, no matter. Hold up. Yeah. So it's a big, big rewrite even when it succeeds. It's still hard to get out there and you've got to be very confident. So, I I say I I'm always an atheist and

Speaker 2   17:20
I say like fourth data side of things. Yeah

Speaker 1   17:22
Everybody

Speaker 2   17:22
Does this. They you touch which is great. Well it's always just the outside the day that you're always getting the same. It's always so nasty

Speaker 1   17:31
Database. So hard. How

Speaker 2   17:33
Do you how do you apply this to the data side effects? Yeah, so I think one of the things is to

Speaker 1   17:39
Put your engineering hat on and take a look at what's happening and say, what's the smallest thing? You can, we were only aware to write a very small part of this app. What would that look like? And can we do that? Is it possible at all to One of those systems. Um because then you avoid the whole giant cut over and void that the databases in particular. First off, future flags are going to be your absolute savior in this because you can do things like, okay? Send one percent of the traffic over there. Uh and then 25 of the traffic and then 50, oh, that's too much. And then like flip the switch back and then uh, keep that going. Uh we I think example of a Target, was our migration to a sharded database, from a single postgres incidents. Um, In that case it was, are we, we look at sinus And he said there, hooray a silver bullet. And it was not nearly as silverability as we had. And so trying to identify, I think, I think, and that was also that big bang. We always, always it wasn't, we tried it so long to do the the whole shift. And then finally, it was like, what if we gonna move one house camera to a new thing? It was like it's a really good idea. Like, okay, well, our types are to fundamentally right Pepin done for six months by then and they finally went what if we get a small bin. Uh and so again trying to find what is the kind of community that you can slice on especially your databases, that's nice because that's how you charge it. What happened was starting figuring out how we shard exactly one customer, which was us. So that when anything went wrong, Okay, that's a bummer but none of our customers noticed and that was the Shakedown Cruise that finally found all of those bugs. Uh there I think like you see this, like there's a bunch of different ways to apply this. That's one of them is like, how do we charge chart? Exactly one unit out. Um, if you're doing that um, Things like monoliths to microservices is like okay, where's the problem? Slice. That off one like one single microservice. And, Move that over instead of all the microservices at once. And the nice thing there is you can Okay, we pull up one microservice. Oh, and now everything's faster. Cuz that one's in Rust instead of phv3 or whatever. Uh and and do we need to do more? I don't think so. We're successful. We're should we do more? Let's find out. Um, Does that help? Yeah, yeah so yeah. So that's that's this Wrangler pattern is just fine. Find the smallest unit of value. You can get typescript. We're very lucky. It's like okay it's one file, can we convert one final touch? Yes. Okay. And then one more break. And then going from there, each one was diverted and deployed and running. And we could detect problems because you would think that just moving things to typescript would not cause problems. And yet they did. It's it problems will happen and having the problems of it is small bucket as possible tonight. Right. Um, next door pit, the forever project. Uh, this was the front end rear, right beforehand? Uh was it actually started? It's a I joined jellyfish in there. Four years old. As a company, the project haven't been going on for two years. So, the front rear hasn't been going on for half the life of the company. And was completely stalled. It was like, what if we the initial idea was? What if we took a page with a bunch of wraps and tables and interesting information on it and then one by one each component on that page moved from Django templates to react. Which meant if you're looking at a page, you could not tell where in the code base, Particular component with And so people were like, oh this is really a struggle, it's taking forever. All of my regular tickets are taking forever. I will get to this later. And so, with the rear rate, we did a few things differently. Uh, you're gonna hate me for this, but one of the most important things was jury Just getting back to, that sort of thing is, is for for typescript especially. And then for the full rewrite later was Breaking and like breaking down. Is it just me sitting at a keyboard going through our code base and creating tickets? It was not fun work, but being able to say, hey, every ticket here should take you a couple hours to an afternoon. Was so important because people to laugh and pick up a ticket and what should be a quick fix turns into two weeks of Hell and being able to say look it takes you longer than that, put it back. And it was really good. We also tagged tickets. For we had a bunch of actually back in Engineers who was like, I really wanted to learn from it, bless your heart. Uh, and but it's just always been very confusing and I never quite get it and they wanted to get their toes in here. So we tag teams like this is going to be easy. Is this is straightforward and simple. I could probably knock out all of those tickets. At the time, it took me to make those tickets. But it was really important to bring more momentum in. Bring more people in uh and get that going, make this a group effort that everyone can be proud of. So, yeah, you need to put your project management hat on for a rewrite, but again, that's telling your boss. Hey, look at me. I'm flexible. I'm doing lots of cool things and leaving this. And also this was more fun. Uh, we had a leaderboard. And so since we have okay, all the files in the code base, how many are converted we can say? How far are we from this project and since the last time we've talked at every engineering All Hands every couple of weeks. We've done the most work that feels good to say if the brugrats can be thankless and you say, hey, thank you, you know, Davis and Tina for doing all of these miles over the course. And then Davidson Tina feel pretty good. And everyone else goes, wait, I want my name on that list. How do I help? Well, here's all the documentation. And I got the momentum going and it kept it sustaining the momentum because we had progress towards a measurable goal instead of Well, we gotta gotta make all the times, right? And also reporting on those business numbers that we came from in the first Target. And digging into those and saying, hey, how are we doing? And there was a surprise here actually. We dug in and found out that. Okay, so the average cycle time for a ticket from start work to end. Work for front. End is going down. That's good. The percent of time in the front end, we're spending on bucks is going down. And the average amount of time we spend on a bug ticket is going up. That wasn't supposed to happen. And then digging in comparing gold versus new we found it's like all that were. We killed all the the bugs that were different parts of the system talking to each other. That were simple fixes, those are getting fixed before the pull request. And then we had all the fiendishly difficult dealing with react render cycle timing. And all of that things were still left. So they we were spent less time at bugs, baseball ticket and the ones that were left with the a million ones. And I wish I could tell you how to rewrite things to avoid all bugs. But if I, if I could, I'd be a lot richer. And also, the avoiding the forever project is nice because you could say, hey, are we done? And it's not, well, did we rewrite the code base? But do we accomplish what we set out to do, our customer our page load time's going, we didn't put it right. The whole code base. We wrote three hot pads in the database and now they're using the new caching layer and turns out. That's all that it took. And it's just those three pads and those three queries that were bottled. When sometimes you're like a month in you're like, oh, we're done. Everything's fast. People are buying more socks now. And so, that's the, the fourth tar pit. Uh, and so, will this device work for you? Maybe I hope. So, this is some of the stories of the experience. I've had uh I work mostly in SAS. Big and small. So that's my life. Uh it certainly is different. If you're working on embedded systems I heard a story about someone they got to deploy every six months because that deployment been taking me to USB stick and going to every customer in the world and plugging it into their systems. And, you know, a rewrite where you deploy every day is a lot easier than one range employ every six months. But hopefully some of these principles are still useful. Luckily, name of the book, I really like. Uh, we build our computer systems. The way we build our cities over time without a plan on top of ruins. I live in Boston. Uh, I I my house I am in is a 160 years old. We don't know what the property lines are. Uh, just because it's so old, maybe they were accurate. And uh it's it's always fun digging around. Uh, Trying to put a new Subway or something like that. And of course, whenever I say that anyone from Europe is like, Ah, that's cute. Only a century or two to deal with and hopefully it can be a little more planned uh in in the coming years and fewer ruins to build on top of this court is also the open and goat to kill it with fire, which is a book. Uh, if you read this book, you go. Wow. Brandon was coming to the status from the booktube, the whole talk. But it's very good. It goes into a lot more detail about the sociology, the social of the socio-technical systems. And uh, yeah, I very much recommend it again. I work a jellyfish. It's really cool. I get to do things like across school shop and say why is nothing getting done and we'll crunch all the numbers and say because your engineers are spending over half of their time in meetings. Uh, and then honestly, uh, like so. Hey, hey, look, we've got data. Now, to back this up, we can refactor our meeting schedule. But also just the leadership actually saying, okay, and they cancel, most of that reading said if they're important, they'll come back, they didn't come back but also to their credit that company as a customer. When how do we get here? And the whole leadership got together and said, like how do we make sure that people feel okay, canceling meetings, I enjoy. And, uh, if you want to join us, this link probably won't be that helpful, uh, because uh, the only thing on there is an engineering manager. If you want to do that, Douglas, we do remote iOS, great. Um, I know a position is opening on my team. It's not up there yet, so if you want to work specifically with me, uh, we are doing a bunch of refactor, surprisingly. Except this time instead of the how the user interface, how do you, how do you change everything without making the users mad? Check that. Uh yeah. If you have questions, two things like that.



```